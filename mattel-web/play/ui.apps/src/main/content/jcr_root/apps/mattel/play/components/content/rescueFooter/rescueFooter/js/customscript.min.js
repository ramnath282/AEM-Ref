
function createCookie(e,t,n){if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);var i="; expires="+o.toGMTString()}else i="";document.cookie=e+"="+t+i+"; path=/"}function readCookie(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var i=n[o];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null}function eraseCookie(e){createCookie(e,"",-1)}

var device,locale = $("#formLocale").val();

var formLocale=$("html").attr('lang');
localInfo="/"+formLocale.replace("-","_");


function reposition() {
    var e = $(this),
        t = e.find(".modal-dialog");
    e.css("display", "block"), t.css("margin-top", Math.max(0, ($(window).height() - t.height()) / 2))
}

function deviceType() {
        if (Modernizr.mq('all and (max-width: 640px)')) {
            device = 'mobile';
            window.fp.device = 'mobile';
        } else if (Modernizr.mq('all and (max-width: 1023px) and (min-width: 641px)')) {
            device = 'tablet';
            window.fp.device = 'tablet';
        } else if (Modernizr.mq('all and (min-width: 1024px)')) {
            device = 'desktop';	
            window.fp.device = 'desktop';
        }
}

function footerAccordion() {
    if(window.innerWidth <= 767) {
        $(".footer-tiles .accordion-toggle h5").on("click", function() {
            event.preventDefault(), $(this).toggleClass("shown")
        })
    }
}

function headerFooterRender() {

    var headerFooterPath = "/bin/getHeadernFooter";
    var currentPagePathHeader = $("#curResourcePagePath").val()+"&requestFor=header"; 
    $.ajax({
        type: 'GET',

		 "url": window.location.protocol + "//" + window.location.host + headerFooterPath + "?currentPagePath=" + currentPagePathHeader,
       // url: "https://www.fisher-price.com/"+formLocale+"/header.html", 

     success: function(response){
         if(response !='') {
			$('#header-content').html(response);
        	getSearch(); 
        	searchautocomplete();
			searchIconClick();
        			setTimeout(function(){
        				 if(formLocale == 'en-US') {
							$('#promo-wrapper').html(Promodata.MarketingSpotData[0].baseMarketingSpotActivityData[0].marketingContentDescription[0].marketingText);
                         }else{
							 // newly added to activate the MRS modal pop up for international markets
                              if (window.location.href.indexOf("email-pop-up") > -1) {
                               $('.click-link')[0].click();                         
                              }
                         }
            		},2000);


         }


  	}});
	var currentPagePathFooter = window.location.pathname+"&requestFor=footer";
     $.ajax({
        type: 'GET',

		 "url": window.location.protocol + "//" + window.location.host + headerFooterPath + "?currentPagePath=" + currentPagePathFooter,
       // url: "https://www.fisher-price.com/"+formLocale+"/header.html", 

     success: function(response){
         if(response !='') {
			$('#footer-content').html(response)
         }

  	}});

}

function searchIconClick() {
 $("#main-top-header .search-icon, .go-btn").on('click',function(e){
        if((device === "desktop" && $("#main-top-header .input-search.tt-input").val() != "") || ($("#searchBox .search-box").hasClass('active') && $("#main-top-header .input-search.tt-input").val() != "")) {
            searchPage($("#main-top-header .input-search.tt-input").val());
        } else {        
            e.stopPropagation();
            $("#searchBox .search-box").toggleClass("active");
            $("#main-top-header .input-search.tt-input").focus();
        }
    });

}

function isValidEmailAddress(emailAddress) {
    // var pattern = new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);
	var pattern = /^[A-Za-z0-9._%+-]+@(?:[A-Za-z0-9-]+\.){1,2}[A-Za-z]{2,4}$/;
   return pattern.test(emailAddress);
}

function GetStarted(isMobile) {
    var email = '';
    var isValid = true;
    var errorSpanId = "#emailError";
    if (isMobile == 'true') {
        email = $("#emailMobile").val();
        errorSpanId = errorSpanId + "Mobile";
        
    }
    else {
        email = $("#emailDesktop").val();
    }
    if (email =='') {
        if (isMobile == "true") {
            $('#email-pop-up').modal('hide');
        }
        isValid = false;
        $(errorSpanId).text("Please enter your Email Address");
        
    }
    else if (isValidEmailAddress(email) == false) {
        if (isMobile == "true") {
            $('#email-pop-up').modal('hide');
        }
        isValid = false;
        $(errorSpanId).text("Please enter a valid Email Address");
    }


    if (isValid) {
	//_emailSignUp();
		 //$('.click-link')[0].click();
		 client.renderSignup(email);
    }
    else {
        $(errorSpanId).removeClass("hidden");
        $(errorSpanId).closest('.form-group').removeClass("has-error").addClass("has-error");
    }

}

/*function showNavigationMenu() {
     if(window.innerWidth <= 767) {
      $("#main-top-header .navbar-header").on("click", function() {
		$('.primary-nav').fadeToggle(500, function () {
                    ($(this).is(':visible')) ? $('header').css('display','block'): $('header').css('display','none');
                    //($(this).is(':visible')) ? $('header').css('display','block'): $('header').css('display','none')
                });

          });
		 }
}*/

function searchPage(data) {
	if(localInfo.toLowerCase() !== "/en_us"){
            //window.location.href = localInfo + "/search/index.html?Ntt=" + data;
            window.location.href =  "https://www.fisher-price.com"+localInfo+"/search/index.html?Ntt=" + data;
        }
        else{
             //window.location.href = window.fp.oneStore.searchPageURL + data;
            window.location.href =  "https://fisher-price.mattel.com/shop/SearchDisplay?categoryId=&storeId=10151&catalogId=10101&langId=-1&sType=SimpleSearch&searchTerm="+ data;
    }
}

function searchautocomplete() {
		if(localInfo.toLowerCase() == "/en_us") {
    		if($('#main-top-header .input-search').length > 0)  {

                 $('#main-top-header .input-search').typeahead({
				   hint: true,
                   highlight: true,
                   minLength: 2
                 },
                 {
                   name: 'autoComplete',
                   displayKey: 'q',
                   display: 'dq',
                   source: function (query, sync, async) {

                           $.get("https://www.fisher-price.com"+localInfo + '/Search/GetSearchSuggestions', { q: query }, function (data) {
                        
                               var $results = [];
                               data = JSON.parse(data);
                               if(data.response && data.response.suggestions)  {
                                   async(data.response.suggestions);
                               }
                               
                           });
                    },
                     
                     templates: {
                        suggestion: function(data){
                          return "<div onclick = \"searchPage('" + data.q + "')\">" + data.dq +  "</div>";
                        }
                      }
                 });
              }
			}
}

function getSearch() {

    $("#main-top-header .input-search,.search-result-wrapper .input-search").on('keyup keypress', function(e){
		if(e.which == 13) {        
            var data = $(this).val();
            //var localInfo = "en_us"; 
            if(localInfo.toLowerCase() !== "/en_us"){
                //window.location.href = localInfo + "/search/index.html?Ntt=" + data;
                window.location.href =  "https://www.fisher-price.com"+localInfo+"/search/index.html?Ntt=" + data;
            }
            else{
                 //window.location.href = window.fp.oneStore.searchPageURL + data;
                window.location.href =  "https://fisher-price.mattel.com/shop/SearchDisplay?categoryId=&storeId=10151&catalogId=10101&langId=-1&sType=SimpleSearch&searchTerm="+ data;
            }
        }
    });

}


$(document).ready(function() {
          footerAccordion() , headerFooterRender()
});
